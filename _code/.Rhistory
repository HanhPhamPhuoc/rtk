l.ka <- l[5]
l.image <- l[6]
l.image <- str_replace(l.image, "<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.strokes <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.on <- l[17]
l.kun <- l[18]
l.word <- l[19]
l.word <- str_replace_all(l.word, "<br[ ]*[/]?>", "\n\n")
l.example <- l[20]
l.na <- paste0(str_dup("0",4-str_length(l.no6)),l.no6)
l.pre <- koo.v4[koo.v4$no==l.no,2]
l.koo <- koo.v4[koo.v4$no==l.no,3]
content <- paste0("---",
"\nlayout: kanji",
"\nv4: ", l.no,
"\nv6: ", l.no6,
"\nkeyword: ",l.key,
"\nkanji: ", l.ka,
"\nstrokes: ", l.strokes,
"\nimage: ", l.image,
"\non: ", l.on,
ifelse(l.kun=="","",paste0("\nkun: ", l.kun)),
"\npermalink: /", l.no6,"/",
"\nredirect_from:",
"\n - /", l.ka, "/",
"\n - /", tolower(l.key), "/",
"\n - /v4/", l.no, "/",
ifelse(str_detect(l.ka,"・"),
paste0("\n - /", str_sub(l.ka,1,1), "/",
"\n - /", str_sub(l.ka,3,3), "/"),""),
"\nprev: ", as.numeric(l.no6) - 1,
"\nnext: ", as.numeric(l.no6) + 1,
ifelse(l.hei=="","",
paste0("\nheisig: \"",l.hei,"\"")),
ifelse(l.pre=="","",
paste0("\npremit: \"",l.pre,"\"")),
"\n---",
"\n\n", l.koo,
"\n")
l.path <- paste0("/data/repos/manhtai/rtk/kanji/",l.na,".md")
writeLines(content, l.path)
}
l[5]
l[6]
l[7]
l[8]
for (i in 1:n) {
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.no <- l[2]
l.no6 <- l[3]
l.key <- l[4]
l.ka <- l[5]
l.img <- str_replace(l[6],
"<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.ele <- l[8]
l.sks <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.on <- l[17]
l.kun <- l[18]
l.word <- l[19]
l.word <- str_replace_all(l.word, "<br[ ]*[/]?>", "\n\n")
l.example <- l[20]
l.na <- paste0(str_dup("0",4-str_length(l.no6)),l.no6)
l.pre <- koo.v4[koo.v4$no==l.no,2]
l.koo <- koo.v4[koo.v4$no==l.no,3]
content <- paste0("---",
"\nlayout: kanji",
"\nv4: ", l.no,
"\nv6: ", l.no6,
"\nkanji: ", l.ka,
"\nkeyword: ",l.key,
"\nelements: ", l.ele,
"\nstrokes: ", l.sks,
"\nimage: ", l.img,
"\non: ", l.on,
ifelse(l.kun=="","",paste0("\nkun: ", l.kun)),
"\npermalink: /", l.no6,"/",
"\nredirect_from:",
"\n - /", l.ka, "/",
"\n - /", tolower(l.key), "/",
"\n - /v4/", l.no, "/",
ifelse(str_detect(l.ka,"・"),
paste0("\n - /", str_sub(l.ka,1,1), "/",
"\n - /", str_sub(l.ka,3,3), "/"),""),
"\nprev: ", as.numeric(l.no6) - 1,
"\nnext: ", as.numeric(l.no6) + 1,
ifelse(l.hei=="","",
paste0("\nheisig: \"",l.hei,"\"")),
ifelse(l.pre=="","",
paste0("\npremit: \"",l.pre,"\"")),
"\n---",
"\n\n", l.koo,
"\n")
l.path <- paste0("/data/repos/manhtai/rtk/kanji/",l.na,".md")
writeLines(content, l.path)
}
koohii <- readLines("/data/Downloads/rtk20.txt")
koo.v4 <- matrix(rep("",3*3030), ncol = 3,
dimnames = list(1:3030,c("no","s0","s2")))
i <- 37
# Reset k.s0
k.s0 <- ""
# Input
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
# Set V4 number to k.no
k.no <- k[5]
# k[7] is V6 number
if (as.numeric(k[7]) < 2201) {
# Check and set premitive to k.s0
k.s1 <- k[3]
k.pc <- str_locate(k.s1, "[*]")
k.pc2 <- str_locate(k.s1, "As a premitive")
k.pc2
k.s0 <- ""
# Input
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
# Set V4 number to k.no
k.no <- k[5]
dimnames = list(1:3030,c("no","s0","s2")))
k.s1 <- k[3]
k.pc <- str_locate(k.s1, "[*]")
k.pc2 <- str_locate(k.s1, "As a premitive")
k.pc2
k.s1
k.pc2 <- str_locate(k.s1, "As a primitive")
k.s1
k.pc2
??"control"
k.pc
# Reset k.s0
k.s0 <- ""
# Input
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
# Set V4 number to k.no
k.no <- k[5]
# k[7] is V6 number
if (as.numeric(k[7]) < 2201) {
# Check and set premitive to k.s0
k.s1 <- k[3]
k.pc <- str_locate(k.s1, "[*]")
k.pc2 <- str_locate(k.s1, "As a primitive")
if (!is.na(k.pc[1])) {
if (k.pc[1] < 4) {
k.lc <- str_locate(k.s1, "[[][[:digit:]]+[]]")
if (anyNA(k.lc)) {
k.lim <- str_length(k.s1)
} else {
k.lim <- k.lc[2]
}
k.s0 <- str_sub(k.s1, k.pc[1]+1, k.lim)
} else {
k.s0 <- str_sub(k.s1, k.pc[1]+1, str_length(k.s1))
}
} else {
if (!is.na(k.pc2[1])) {
k.s0 <- str_sub(k.s1, k.pc2[1], str_length(k.s1))
if (str_sub(k.s0, str_length(k.s0)) == "\"") {
k.s0 <- str_sub(k.s0, 1, str_length(k.s0) - 1)
}
}
}
if (str_sub(k.s0, str_length(k.s0)) == "\"") {
k.s0 <- str_sub(k.s0, 1, str_length(k.s0) - 1)
}
k.s0 <- str_trim(k.s0)
k.s0 <- str_replace_all(k.s0, "\"\"", "\"")
k.s0 <- str_replace_all(k.s0, "\"", "&quot;")
k.s0 <- str_replace_all(k.s0, "[[:space:]]{2,}", " ")
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:11]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "http://kanji.koohii.com/study/kanji/", "../v4/")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to matrix
koo.v4[i,1] <- k.no
koo.v4[i,2] <- k.s0
koo.v4[i,3] <- k.s2
}
koo.v4[37,]
for (i in 1:3030) {
# Reset k.s0
k.s0 <- ""
# Input
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
# Set V4 number to k.no
k.no <- k[5]
# k[7] is V6 number
if (as.numeric(k[7]) < 2201) {
# Check and set premitive to k.s0
k.s1 <- k[3]
k.pc <- str_locate(k.s1, "[*]")
k.pc2 <- str_locate(k.s1, "As a primitive")
if (!is.na(k.pc[1])) {
if (k.pc[1] < 4) {
k.lc <- str_locate(k.s1, "[[][[:digit:]]+[]]")
if (anyNA(k.lc)) {
k.lim <- str_length(k.s1)
} else {
k.lim <- k.lc[2]
}
k.s0 <- str_sub(k.s1, k.pc[1]+1, k.lim)
} else {
k.s0 <- str_sub(k.s1, k.pc[1]+1, str_length(k.s1))
}
} else {
if (!is.na(k.pc2[1])) {
k.s0 <- str_sub(k.s1, k.pc2[1], str_length(k.s1))
if (str_sub(k.s0, str_length(k.s0)) == "\"") {
k.s0 <- str_sub(k.s0, 1, str_length(k.s0) - 1)
}
}
}
if (str_sub(k.s0, str_length(k.s0)) == "\"") {
k.s0 <- str_sub(k.s0, 1, str_length(k.s0) - 1)
}
k.s0 <- str_trim(k.s0)
k.s0 <- str_replace_all(k.s0, "\"\"", "\"")
k.s0 <- str_replace_all(k.s0, "\"", "&quot;")
k.s0 <- str_replace_all(k.s0, "[[:space:]]{2,}", " ")
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:11]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "http://kanji.koohii.com/study/kanji/", "../v4/")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to matrix
koo.v4[i,1] <- k.no
koo.v4[i,2] <- k.s0
koo.v4[i,3] <- k.s2
}
}
saveRDS(koo.v4,"koohii.rds")
koo.v4 <- readRDS("koohii.rds")
koo.v4 <- as.data.frame(koo.v4)
n <- length(data)
n <- 10
for (i in 1:n) {
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.no <- l[2]
l.no6 <- l[3]
l.key <- l[4]
l.ka <- l[5]
l.img <- str_replace(l[6],
"<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.ele <- l[8]
l.sks <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.on <- l[17]
l.kun <- l[18]
l.word <- l[19]
l.word <- str_replace_all(l.word, "<br[ ]*[/]?>", "\n\n")
l.example <- l[20]
l.na <- paste0(str_dup("0",4-str_length(l.no6)),l.no6)
l.pri <- koo.v4[koo.v4$no==l.no,2]
l.koo <- koo.v4[koo.v4$no==l.no,3]
content <- paste0("---",
"\nlayout: kanji",
"\nv4: ", l.no,
"\nv6: ", l.no6,
"\nkanji: ", l.ka,
"\nkeyword: ",l.key,
"\nelements: ", l.ele,
"\nstrokes: ", l.sks,
"\nimage: ", l.img,
"\non: ", l.on,
ifelse(l.kun=="","",paste0("\nkun: ", l.kun)),
"\npermalink: /", l.no6,"/",
"\nredirect_from:",
"\n - /", l.ka, "/",
"\n - /", tolower(l.key), "/",
"\n - /v4/", l.no, "/",
ifelse(str_detect(l.ka,"・"),
paste0("\n - /", str_sub(l.ka,1,1), "/",
"\n - /", str_sub(l.ka,3,3), "/"),""),
"\nprev: ", as.numeric(l.no6) - 1,
"\nnext: ", as.numeric(l.no6) + 1,
ifelse(l.hei=="","",
paste0("\nheisig: \"",l.hei,"\"")),
ifelse(l.pre=="","",
paste0("\nprimit: \"",l.pri,"\"")),
"\n---",
"\n\n", l.koo,
"\n")
l.path <- paste0("/data/repos/manhtai/rtk/kanji/",l.na,".md")
writeLines(content, l.path)
}
n <- length(data)
for (i in 1:n) {
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.no <- l[2]
l.no6 <- l[3]
l.key <- l[4]
l.ka <- l[5]
l.img <- str_replace(l[6],
"<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.ele <- l[8]
l.sks <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.on <- l[17]
l.kun <- l[18]
l.word <- l[19]
l.word <- str_replace_all(l.word, "<br[ ]*[/]?>", "\n\n")
l.example <- l[20]
l.na <- paste0(str_dup("0",4-str_length(l.no6)),l.no6)
l.pri <- koo.v4[koo.v4$no==l.no,2]
l.koo <- koo.v4[koo.v4$no==l.no,3]
content <- paste0("---",
"\nlayout: kanji",
"\nv4: ", l.no,
"\nv6: ", l.no6,
"\nkanji: ", l.ka,
"\nkeyword: ",l.key,
"\nelements: ", l.ele,
"\nstrokes: ", l.sks,
"\nimage: ", l.img,
"\non: ", l.on,
ifelse(l.kun=="","",paste0("\nkun: ", l.kun)),
"\npermalink: /", l.no6,"/",
"\nredirect_from:",
"\n - /", l.ka, "/",
"\n - /", tolower(l.key), "/",
"\n - /v4/", l.no, "/",
ifelse(str_detect(l.ka,"・"),
paste0("\n - /", str_sub(l.ka,1,1), "/",
"\n - /", str_sub(l.ka,3,3), "/"),""),
"\nprev: ", as.numeric(l.no6) - 1,
"\nnext: ", as.numeric(l.no6) + 1,
ifelse(l.hei=="","",
paste0("\nheisig: \"",l.hei,"\"")),
ifelse(l.pre=="","",
paste0("\nprimit: \"",l.pri,"\"")),
"\n---",
"\n\n", l.koo,
"\n")
l.path <- paste0("/data/repos/manhtai/rtk/kanji/",l.na,".md")
writeLines(content, l.path)
}
for (i in 1:n) {
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.no <- l[2]
l.no6 <- l[3]
l.key <- l[4]
l.ka <- l[5]
l.img <- str_replace(l[6],
"<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.ele <- l[8]
l.sks <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.on <- l[17]
l.kun <- l[18]
l.word <- l[19]
l.word <- str_replace_all(l.word, "<br[ ]*[/]?>", "\n\n")
l.example <- l[20]
l.na <- paste0(str_dup("0",4-str_length(l.no6)),l.no6)
l.pri <- koo.v4[koo.v4$no==l.no,2]
l.koo <- koo.v4[koo.v4$no==l.no,3]
content <- paste0("---",
"\nlayout: kanji",
"\nv4: ", l.no,
"\nv6: ", l.no6,
"\nkanji: ", l.ka,
"\nkeyword: ",l.key,
"\nelements: ", l.ele,
"\nstrokes: ", l.sks,
"\nimage: ", l.img,
"\non: ", l.on,
ifelse(l.kun=="","",paste0("\nkun: ", l.kun)),
"\npermalink: /", l.no6,"/",
"\nredirect_from:",
"\n - /", l.ka, "/",
"\n - /", tolower(l.key), "/",
"\n - /v4/", l.no, "/",
ifelse(str_detect(l.ka,"・"),
paste0("\n - /", str_sub(l.ka,1,1), "/",
"\n - /", str_sub(l.ka,3,3), "/"),""),
"\nprev: ", as.numeric(l.no6) - 1,
"\nnext: ", as.numeric(l.no6) + 1,
ifelse(l.hei=="","",
paste0("\nheisig: \"",l.hei,"\"")),
ifelse(l.pri=="","",
paste0("\nprimit: \"",l.pri,"\"")),
"\n---",
"\n\n", l.koo,
"\n")
l.path <- paste0("/data/repos/manhtai/rtk/kanji/",l.na,".md")
writeLines(content, l.path)
}
i <- 29
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.no <- l[2]
l.no6 <- l[3]
l.key <- l[4]
l.ka <- l[5]
l.img <- str_replace(l[6],
"<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.ele <- l[8]
l.sks <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.on <- l[17]
l.on
for (i in 1:n) {
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.no <- l[2]
l.no6 <- l[3]
l.key <- l[4]
l.ka <- l[5]
l.img <- str_replace(l[6],
"<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.ele <- l[8]
l.sks <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.on <- l[17]
l.kun <- l[18]
l.word <- l[19]
l.word <- str_replace_all(l.word, "<br[ ]*[/]?>", "\n\n")
l.example <- l[20]
l.na <- paste0(str_dup("0",4-str_length(l.no6)),l.no6)
l.pri <- koo.v4[koo.v4$no==l.no,2]
l.koo <- koo.v4[koo.v4$no==l.no,3]
content <- paste0("---",
"\nlayout: kanji",
"\nv4: ", l.no,
"\nv6: ", l.no6,
"\nkanji: ", l.ka,
"\nkeyword: ",l.key,
"\nelements: ", l.ele,
"\nstrokes: ", l.sks,
"\nimage: ", l.img,
"\non-yomi: ", l.on,
ifelse(l.kun=="","",paste0("\nkun-yomi: ", l.kun)),
"\npermalink: /", l.no6,"/",
"\nredirect_from:",
"\n - /", l.ka, "/",
"\n - /", tolower(l.key), "/",
"\n - /v4/", l.no, "/",
ifelse(str_detect(l.ka,"・"),
paste0("\n - /", str_sub(l.ka,1,1), "/",
"\n - /", str_sub(l.ka,3,3), "/"),""),
"\nprev: ", as.numeric(l.no6) - 1,
"\nnext: ", as.numeric(l.no6) + 1,
ifelse(l.hei=="","",
paste0("\nheisig: \"",l.hei,"\"")),
ifelse(l.pri=="","",
paste0("\nprimit: \"",l.pri,"\"")),
"\n---",
"\n\n", l.koo,
"\n")
l.path <- paste0("/data/repos/manhtai/rtk/kanji/",l.na,".md")
writeLines(content, l.path)
}
