# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:6]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "<a href=\"http://kanji.koohii.com/study/kanji/([[:alnum:]]+)\">([[:alnum:]]+)</a>", "<a href=\"../v4/\\1.html\">\\2</a>")
k.s2
# THIS CODE SPLIT KOOHII STORIES FROM ANKI PACKAGES INTO 2 PARTS:
# - RTK1-V6 PART CONTAINS 2200 KANJI, SAVE IN 'rtk1-v6-koohii.rds'
# - RTK3-REMAIN, SAVE IN 'rtk3-remain.rds'
# ANKI PACKAGES GOT FROM HERE:
# https://ankiweb.net/shared/info/2843053490
library(stringr)
# Load koohii raw data
koohii <- readLines("/data/Downloads/apkg/RTK20.txt")
nk <- length(koohii)
koo.v4 <- matrix(rep("",3*2200), ncol = 3,
dimnames = list(1:2200,c("no","s0","s2")))
s.v4 <- matrix(rep("",5*(nk-2200)), ncol = 5,
dimnames = list(1:(nk-2200),c("no","ka","key",
"sks","s2")))
count <- 0
count2 <- 0
# Split data into rtk1-v6 and rtk3-remain
for (i in 1:nk) {
# Reset k.s0
k.s0 <- ""
# Input
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
# Set V4 number to k.no
k.no <- k[5]
# k[7] is V6 number
if (as.numeric(k[7]) < 2201) {
# Check and set premitive to k.s0
k.s1 <- k[3]
k.pc <- str_locate(k.s1, "[*]")
if (!is.na(k.pc[1])) {
if (k.pc[1] < 4) {
k.lc <- str_locate(k.s1, "[[][[:digit:]]+[]]")
if (anyNA(k.lc)) {
k.lim <- str_length(k.s1)
} else {
k.lim <- k.lc[2]
}
k.s0 <- str_sub(k.s1, k.pc[1]+1, k.lim)
}
}
if (str_sub(k.s0, str_length(k.s0)) == "\"") {
k.s0 <- str_sub(k.s0, 1, str_length(k.s0) - 1)
}
k.s0 <- str_trim(k.s0)
k.s0 <- str_replace_all(k.s0, "\"\"", "\"")
k.s0 <- str_replace_all(k.s0, "\"", "&quot;")
k.s0 <- str_replace_all(k.s0, "[[:space:]]{2,}", " ")
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:6]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "<a href=\"http://kanji.koohii.com/study/kanji/([[:alnum:]]+)\">([[:alnum:]]+)</a>", "<a href=\"../v4/\\1.html\">\\2</a>")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to matrix
count <- count + 1
koo.v4[count,1] <- k.no # V4 number
koo.v4[count,2] <- k.s0 # Primitive
koo.v4[count,3] <- k.s2 # Koohii stories
} else {
# This part copy from above, if you edit above, copy
# and paste below.
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:6]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "http://kanji.koohii.com/study/kanji/", "../v4/")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to another matrix
count2 <- count2 + 1
s.v4[count2,1] <- k.no # V4 number
s.v4[count2,2] <- k[1] # Kanji
s.v4[count2,3] <- k[2] # Keyword
s.v4[count2,4] <- k[4] # Strokes
s.v4[count2,5] <- k.s2 # Koohii stories
}
}
for (i in 1:nk) {
# Reset k.s0
k.s0 <- ""
# Input
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
# Set V4 number to k.no
k.no <- k[5]
# k[7] is V6 number
if (as.numeric(k[7]) < 2201) {
# Check and set premitive to k.s0
k.s1 <- k[3]
k.pc <- str_locate(k.s1, "[*]")
if (!is.na(k.pc[1])) {
if (k.pc[1] < 4) {
k.lc <- str_locate(k.s1, "[[][[:digit:]]+[]]")
if (anyNA(k.lc)) {
k.lim <- str_length(k.s1)
} else {
k.lim <- k.lc[2]
}
k.s0 <- str_sub(k.s1, k.pc[1]+1, k.lim)
}
}
if (str_sub(k.s0, str_length(k.s0)) == "\"") {
k.s0 <- str_sub(k.s0, 1, str_length(k.s0) - 1)
}
k.s0 <- str_trim(k.s0)
k.s0 <- str_replace_all(k.s0, "\"\"", "\"")
k.s0 <- str_replace_all(k.s0, "\"", "&quot;")
k.s0 <- str_replace_all(k.s0, "[[:space:]]{2,}", " ")
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:6]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "<a href=\"http://kanji.koohii.com/study/kanji/([[:alnum:]]+)\">([[:alnum:]]+)</a>", "<a href=\"../v4/\\1.html\">\\2</a>")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to matrix
count <- count + 1
koo.v4[count,1] <- k.no # V4 number
koo.v4[count,2] <- k.s0 # Primitive
koo.v4[count,3] <- k.s2 # Koohii stories
} else {
# This part copy from above, if you edit above, copy
# and paste below.
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:6]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "<a href=\"http://kanji.koohii.com/study/kanji/([[:alnum:]]+)\">([[:alnum:]]+)</a>", "<a href=\"../v4/\\1.html\">\\2</a>")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to another matrix
count2 <- count2 + 1
s.v4[count2,1] <- k.no # V4 number
s.v4[count2,2] <- k[1] # Kanji
s.v4[count2,3] <- k[2] # Keyword
s.v4[count2,4] <- k[4] # Strokes
s.v4[count2,5] <- k.s2 # Koohii stories
}
}
saveRDS(koo.v4,"rtk1-v6-koohii.rds")
saveRDS(s.v4,"rtk3-remain-koohii.rds")
koohii <- readLines("/data/Downloads/apkg/RTK20.txt")
nk <- length(koohii)
koo.v4 <- matrix(rep("",3*2200), ncol = 3,
dimnames = list(1:2200,c("no","s0","s2")))
s.v4 <- matrix(rep("",5*(nk-2200)), ncol = 5,
dimnames = list(1:(nk-2200),c("no","ka","key",
"sks","s2")))
count <- 0
count2 <- 0
# Split data into rtk1-v6 and rtk3-remain
for (i in 1:nk) {
# Reset k.s0
k.s0 <- ""
# Input
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
# Set V4 number to k.no
k.no <- k[5]
# k[7] is V6 number
if (as.numeric(k[7]) < 2201) {
# Check and set premitive to k.s0
k.s1 <- k[3]
k.pc <- str_locate(k.s1, "[*]")
if (!is.na(k.pc[1])) {
if (k.pc[1] < 4) {
k.lc <- str_locate(k.s1, "[[][[:digit:]]+[]]")
if (anyNA(k.lc)) {
k.lim <- str_length(k.s1)
} else {
k.lim <- k.lc[2]
}
k.s0 <- str_sub(k.s1, k.pc[1]+1, k.lim)
}
}
if (str_sub(k.s0, str_length(k.s0)) == "\"") {
k.s0 <- str_sub(k.s0, 1, str_length(k.s0) - 1)
}
k.s0 <- str_trim(k.s0)
k.s0 <- str_replace_all(k.s0, "\"\"", "\"")
k.s0 <- str_replace_all(k.s0, "\"", "&quot;")
k.s0 <- str_replace_all(k.s0, "[[:space:]]{2,}", " ")
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:6]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "<a href=\"http://kanji.koohii.com/study/kanji/([[:alnum:]]+)\">([[:alnum:]]+)</a>", "<a href=\"../v4/\\1.html\">\\2</a>")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to matrix
count <- count + 1
koo.v4[count,1] <- k.no # V4 number
koo.v4[count,2] <- k.s0 # Primitive
koo.v4[count,3] <- k.s2 # Koohii stories
} else {
# This part copy from above, if you edit above, copy
# and paste below.
# Set Koohii stories to k.s2 and clear up
k.s2 <- k[8]
k.s2 <- str_split(k.s2, "<br[ ]*[/]?>")[[1]][2:6]
k.s2 <- str_replace_all(k.s2, "\"\"", "\"")
k.s2 <- str_replace_all(k.s2, "<a href=\"midori://search[?]text=([[:alnum:]]+)\">[[:alnum:]]+</a>", "\\1")
k.s2 <- str_replace_all(k.s2, "midori://search[?]text=", "http://google.com/#q=")
k.s2 <- str_replace_all(k.s2, "<a href=\"http://kanji.koohii.com/study/kanji/([[:alnum:]]+)\">([[:alnum:]]+)</a>", "<a href=\"../v4/\\1.html\">\\2</a>")
k.s2 <- str_replace_all(k.s2, "<span class=\"index\">", "")
k.s2 <- str_replace_all(k.s2, "</span>", "")
k.s2 <- str_replace_all(k.s2, "[[:space:]]{2,}", " ")
k.s2 <- str_trim(k.s2)
k.s2 <- str_c(k.s2, collapse = "\n\n")
# Save to another matrix
count2 <- count2 + 1
s.v4[count2,1] <- k.no # V4 number
s.v4[count2,2] <- k[1] # Kanji
s.v4[count2,3] <- k[2] # Keyword
s.v4[count2,4] <- k[4] # Strokes
s.v4[count2,5] <- k.s2 # Koohii stories
}
}
saveRDS(koo.v4,"rtk1-v6-koohii.rds")
saveRDS(s.v4,"rtk3-remain-koohii.rds")
data <- read.csv("rtk1-v6-strokes.csv")
data <- as.vector(data$flds)
# Load koohii stories data
koo.v4 <- readRDS("rtk1-v6-koohii.rds")
koo.v4 <- as.data.frame(koo.v4)
# Combine two data in each Jekyll post
n <- length(data)
l.nav <- matrix(rep("",2*n), ncol=2,
dimnames=list(1:n,c("no6","ka")))
for (i in 1:n) {
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.nav[i,1] <- l[3]
l.nav[i,2] <- l[5]
}
l.nav <- as.data.frame(l.nav, stringsAsFactors = FALSE)
for (i in 1:n) {
line <- data[i]
line <- str_split(line, "\037")
l <- line[[1]]
l.no <- l[2]
l.no6 <- l[3]
l.key <- l[4]
l.ka <- l[5]
l.img <- str_replace(l[6],
"<img src=\"([[:alnum:]]{6,}).png\" />",
"\\1")
l.ele <- l[8]
l.sks <- l[9]
l.hei <- l[11]
l.hei <- str_replace_all(l.hei, "\"", "&quot;")
l.hei <- str_replace_all(l.hei, "<div>", "\n")
l.hei <- str_replace_all(l.hei, "</div>", "")
l.com <- l[12]
l.com <- str_replace_all(l.com, "\"", "&quot;")
l.com <- str_replace_all(l.com, "<div>", "\n")
l.com <- str_replace_all(l.com, "</div>", "")
l.on <- l[17]
l.kun <- l[18]
l.word <- l[19]
l.word <- str_replace_all(l.word, "<br[ ]*[/]?>", "\n\n")
l.example <- l[20]
l.na <- paste0(str_dup("0",4-str_length(l.no6)),l.no6)
l.pri <- koo.v4[koo.v4$no==l.no,2]
l.koo <- koo.v4[koo.v4$no==l.no,3]
content <- paste0("---",
"\nlayout: kanji",
"\nv4: ", l.no,
"\nv6: ", l.no6,
"\nkanji: ", l.ka,
"\nkeyword: ",l.key,
"\nelements: ", l.ele,
"\nstrokes: ", l.sks,
"\nimage: ", l.img,
"\non-yomi: ", l.on,
ifelse(l.kun=="","",paste0("\nkun-yomi: ", l.kun)),
"\npermalink: /",
ifelse(str_detect(l.ka,"・"),str_sub(l.ka,1,1),l.ka),"/",
"\nredirect_from:",
#"\n - /", l.no6, "/",
"\n - /v4/", l.no, "/",
#ifelse(str_detect(l.ka,"・"),
#			 paste0("\n - /", str_sub(l.ka,1,1), "/",
#			 "\n - /", str_sub(l.ka,3,3), "/"),""),
"\nprev: ", l.nav[l.nav$no6==(as.numeric(l.no6)-1),2],
"\nnext: ", l.nav[l.nav$no6==(as.numeric(l.no6)+1),2],
ifelse(l.pri=="","",
paste0("\nprimit: \"",l.pri,"\"")),
ifelse(l.hei=="","",
paste0("\nheisig: \"",l.hei,"\"")),
ifelse(l.com=="","",
paste0("\ncommen: \"",l.com,"\"")),
"\n---",
"\n\n", l.koo,
"\n")
l.path <- paste0("/data/repos/hochanh/rtk/rtk1-v6/",l.na,".md")
writeLines(content, l.path)
}
s.v4 <- readRDS("rtk3-remain.rds")
s.v4 <- as.data.frame(s.v4, stringsAsFactors = FALSE)
for (i in 1:830) {
s.no <- s.v4[i,1]
s.ka <- s.v4[s.v4$no==s.no,2]
s.key <- s.v4[s.v4$no==s.no,3]
s.sks <- s.v4[s.v4$no==s.no,4]
s.koo <- s.v4[s.v4$no==s.no,5]
s.on <- s.v4[s.v4$no==s.no,6]
# File name
# File content
content <- paste0("---",
"\nlayout: kanji-remain",
"\nv4: ", s.no,
"\nkanji: ", s.ka,
"\nkeyword: ", s.key,
"\nstrokes: ", s.sks,
"\non-yomi: ", s.on,
"\npermalink: /", s.ka,"/",
"\nredirect_from:",
"\n - /v4/", s.no, "/",
"\n---",
"\n\n", ifelse(s.koo=="","","## Koohii stories: "),
"\n\n",s.koo,
"\n")
s.path <- paste0("/data/repos/hochanh/rtk/rtk3-remain/",s.no,".md")
writeLines(content, s.path)
}
koohii <- readLines("/data/Downloads/apkg/RTK20.txt")
nk <- length(koohii)
for (i in 1:nk) {
kine <- koohii[i]
kine <- str_split(kine, "\t")
k <- kine[[1]]
k.no <- k[5]
if (str_length(k.no) < 5) {
k.ka <- k[1]
content <- paste0("<!DOCTYPE html>\n",
"<meta charset=utf-8>\n",
"<title>Redirecting...</title>\n",
"<link rel=canonical href=\"../",
k.ka,
"/index.html\">\n",
"<meta http-equiv=refresh content=\"0; url='../",
k.ka,"/index.html'\">\n",
"<h1>Redirecting...</h1>\n",
"<a href=\"../",
k.ka,
"/index.html\">Click here if you are not redirected.</a>\n",
"<script>location='../",
k.ka,
"/index.html'</script>")
k.path <- paste0("/data/repos/hochanh/rtk/v4/",k.no,".html")
writeLines(content, k.path)
}
}
koohii <- readRDS("rtk1-v6-koohii.rds")
koohii <- as.data.frame(koohii)
library(stringr)
rtk1.full <- read.csv("rtk1-v6-strokes.csv")
rtk1.full <- as.vector(rtk1.full$flds)
rtk3.full <- readLines("rtk3-remain-full.txt")
rtk3.full <- str_split(rtk3.full, "\t")
rtk <- matrix(rep("",2*n), ncol=2,
dimnames=list(1:n,c("no","ka")))
count <- 0
for (i in 1:2200) {
line <- rtk1.full[i]
line <- str_split(line, "\037")
l <- line[[1]]
count <- count + 1
rtk[count,1] <- l[2]
rtk[count,2] <- l[5]
}
for (i in 1:830) {
count <- count + 1
rtk[count,1] <- rtk3.full[[i]][1]
rtk[count,2] <- rtk3.full[[i]][4]
}
rtk <- matrix(rep("",2*3030), ncol=2,
dimnames=list(1:3030,c("no","ka")))
count <- 0
for (i in 1:2200) {
line <- rtk1.full[i]
line <- str_split(line, "\037")
l <- line[[1]]
count <- count + 1
rtk[count,1] <- l[2]
rtk[count,2] <- l[5]
}
for (i in 1:830) {
count <- count + 1
rtk[count,1] <- rtk3.full[[i]][1]
rtk[count,2] <- rtk3.full[[i]][4]
}
View(rtk)
rtk[2099,]
rtk[3030,]
rtk3.full[[i]][1]
rtk3.full[[i]]
rtk <- matrix(rep("",2*3030), ncol=2,
dimnames=list(1:3030,c("no","ka")))
count <- 0
for (i in 1:2200) {
line <- rtk1.full[i]
line <- str_split(line, "\037")
l <- line[[1]]
count <- count + 1
rtk[count,1] <- l[2]
rtk[count,2] <- l[5]
}
for (i in 1:830) {
count <- count + 1
rtk[count,1] <- rtk3.full[[i]][5]
rtk[count,2] <- rtk3.full[[i]][1]
}
rtk[2099,]
rtk[3030,]
writeLines(rtk,"data-full.txt")
full <- readLines("data-full.txt")
full <- str_split(full, "\t")
full[[1]][1]
full[[1]][2]
full <- readLines("data-full.txt")
View(rtk)
write.csv(rtk,"data-full.txt")
full <- read.csv("data-full.csv")
full <- read.csv("data-full.csv", stringsAsFactors = FALSE)
full[i,1]
full[i,1]
full[i,2]
full[i,3]
for (i in 1:3030) {
k.no <- full[i,2]
k.ka <- full[i,3]
content <- paste0("<!DOCTYPE html>\n",
"<meta charset=utf-8>\n",
"<title>Redirecting...</title>\n",
"<link rel=canonical href=\"../",
k.ka,
"/index.html\">\n",
"<meta http-equiv=refresh content=\"0; url='../",
k.ka,"/index.html'\">\n",
"<h1>Redirecting...</h1>\n",
"<a href=\"../",
k.ka,
"/index.html\">Click here if you are not redirected.</a>\n",
"<script>location='../",
k.ka,
"/index.html'</script>")
k.path <- paste0("/data/repos/hochanh/rtk/v4/",k.no,".html")
writeLines(content, k.path)
}
}
for (i in 1:3030) {
k.no <- full[i,2]
k.ka <- full[i,3]
content <- paste0("<!DOCTYPE html>\n",
"<meta charset=utf-8>\n",
"<title>Redirecting...</title>\n",
"<link rel=canonical href=\"../",
k.ka,
"/index.html\">\n",
"<meta http-equiv=refresh content=\"0; url='../",
k.ka,"/index.html'\">\n",
"<h1>Redirecting...</h1>\n",
"<a href=\"../",
k.ka,
"/index.html\">Click here if you are not redirected.</a>\n",
"<script>location='../",
k.ka,
"/index.html'</script>")
k.path <- paste0("/data/repos/hochanh/rtk/v4/",k.no,".html")
writeLines(content, k.path)
}
